### 10 Visual formatting model details

#### 10.1 containing block 的定义

在一些场景下，一个元素的盒子的尺寸和位置是基于该元素的 `containing block`(包含块, 后文中简称 `CB`) 来计算的，元素的 `containing block` 是一个矩形区域，定义如下：

1. 根元素的 `containing block` 叫做 `initial containing block` (初始化包含块, 后文中简称 `ICB`) 。对于 `continuous media` (连续媒体，我们最常见的电脑中的浏览器就是其中的一种)，`IBC` 的尺寸和 `viewport` 一致，而且被固定在画布的起点位置；对于 `paged media` IBC 就是页面区域。 IBC 的 `direction` 的属性值与根元素一致。

2. 除根元素外的其他元素，如果元素的 `position` 是 `relative`, `static`, 那么，元素的 CB 是由该元素的最近 `block container` 类型的或者是新建了 `formating context`(格式化上下文)的父元素的 `content box` 组成。

3. 如果元素的 `position` 是 `fixed`, 那么该元素的 CB 在 `continuous media` 中是由 `viewport` 生成，而在 `paged media` 中由页面区域生成。

4. 如果元素的 `position` 是 `absolute`, 那么该元素的 CB 由最近的有定位（position: relative|absolute|fixed）的祖先元素生成。并且遵守如下规则：

    1. 如果祖先元素是内联元素（display: inline|inline-block）, 那么 CB 是该祖先元素生成的第一个和最后一个内联盒子的 `padding box` 的边界区域。 在 CSS 2.2 规范中，如果该祖先元素被分成了多行，那么 CB 就是未定义的。

    2. 其他情况， CB 由祖先元素的 padding box 组成。

    如果找不到有定位的祖先元素， CB 就是 ICB.

> Note: 本文不对 paged media 的情况做更多解释，因为我也搞不太懂，先放弃，之后再研究。

如下一个没有定位的文档，他的 CB 如下表：

```
    <!DOCTYPE html pubic "-//W3C//DTD HTML 4.01//EN">
    <html>
        <head>
            <title>Illustration of containing blocks</title>
        </head>
        <body id="body">
            <div id="div1">
                <p id="p1">This is text in the first paragraph...</p>
                <p id="p2">This is text
                    <em id="em1"> in the <strong id="strong1">second</strong> paragraph.</em>
                </p>
            </div>
        </body>
    </html>
```

| For box generated by | CB is established by |
| :--------------------| :--------------------|
| html                 | initial CB           |
| body                 | html                 |
| div1                 | body                 |
| p1                   | div1                 |
| p2                   | div1                 |
| em1                  | p2                   |
| strong1              | p2                   |

如果这时候给 div1 一个 position:absolute， 那么 div1 的 CB 就不是 body 了，变成了 ICB, 以为 div1 的父元素中没有一个有定位的。

再接下来，我们设置如下样式：

```
    #div1{
        position: absolute;
        top: 50%;
        left: 50%;
    }

    #em1{
        position: absolute;
        top: 50%;
        left: 50%;
    }
```

这时候 CB 对应的关系如下表：

| For box generated by | CB is established by |
| :--------------------| :--------------------|
| html                 | initial CB           |
| body                 | html                 |
| div1                 | initial CB           |
| p1                   | div1                 |
| p2                   | div1                 |
| em1                  | div1                 |
| strong1              | em1                  |

#### Content Width: the `width` property (Content box 的宽)

> Name: